<!DOCTYPE html>
<html>
<head>
    <title>Portfolio Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/dist/date-fns.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>

</head>
<body>
    <h1>Portfolio Dashboard</h1>

    <h2>Total Portfolio Value: {{ latest_value }} SEK</h2>

    <h3>Percent Changes:</h3>
    <ul>
        {% for key, value in pct_changes.items() %}
            <li>{{ key }}: {{ "%.2f"|format(value) if value is not none else "N/A" }}%</li>
        {% endfor %}
    </ul>

    <h2>Portfolio Value Over Time</h2>
    <canvas id="valueChart" width="900" height="500"></canvas>

    <h2>Portfolio Allocation</h2>
    <canvas id="allocationChart" width="600" height="500"></canvas>

    <script>
        const ctxValue = document.getElementById('valueChart').getContext('2d');
        const valueChart = new Chart(ctxValue, {
            type: 'line',
            data: {
                labels: {{ line_labels | tojson }},
                datasets: [{
                    label: 'Portfölj värde',
                    data: {{ line_data | tojson }},
                    borderColor: 'rgba(75, 192, 192, 1)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    fill: true,
                    pointRadius: 3,
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            parser: 'yyyy-MM-dd',
                            unit: 'day',
                            tooltipFormat: 'yyyy-MM-dd',
                            displayFormats: {
                                day: 'yyyy-MM-dd'
                            }
                        },
                        title: {
                            display: true,
                            text: 'Date'
                        },
                        ticks: {
                            maxRotation: 45,
                            minRotation: 45
                        }
                    },
                    y: {
                        max: {{ y_max }},
                        min: {{ y_min}},
                        title: {
                            display: true,
                            text: 'Value'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true
                    },
                    tooltip: {
                        enabled: true
                    }
                },

            }
        });

        const ctxAlloc = document.getElementById('allocationChart').getContext('2d');
        {% if alloc_labels %}
        const allocationChart = new Chart(ctxAlloc, {
            type: 'pie',
            data: {
                labels: {{ alloc_labels | tojson }},
                datasets: [{
                    label: 'Allocation',
                    data: {{ alloc_values | tojson }},
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.6)',
                        'rgba(54, 162, 235, 0.6)',
                        'rgba(255, 206, 86, 0.6)',
                        'rgba(75, 192, 192, 0.6)',
                        'rgba(153, 102, 255, 0.6)',
                        'rgba(255, 159, 64, 0.6)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'right',
                    },
                    tooltip: {
                        enabled: true
                    }
                }
            }
        });
        {% else %}
        ctxAlloc.canvas.parentNode.innerHTML = '<p>No allocation data available.</p>';
        {% endif %}
    </script>

</body>
</html>
