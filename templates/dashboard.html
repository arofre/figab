
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FIGAB Capital Partners</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/portfolio.css') }}">
<link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/dist/date-fns.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
</head>
<body>

<!-- Accent line at very top -->
<div class="accent-bar"></div>

<header>
  <div class="header-inner">
    <div class="logo-block">
      <span class="logo-monogram">FCP</span>
      <div class="logo-divider"></div>
      <div class="logo-full">FIGAB Capital<br>Partners</div>
    </div>
    <nav id="menu">
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/reports">Reports</a></li>
      </ul>
    </nav>

  </div>
</header>

<main>

  <!-- ── Metrics Bar ── -->
  <div class="metrics-bar">
    <div class="metric-cell">
      <div class="m-key">Portfolio Value</div>
      <div class="m-val">{{ "{:,.0f}".format(latest_value) }}<span class="currency">SEK</span></div>
      <div class="m-sub">Total market value</div>
    </div>
    <div class="metric-cell">
      <div class="m-key">Cash Position</div>
      <div class="m-val">{{ "{:,.0f}".format(cash) }}<span class="currency">SEK</span></div>
      <div class="m-sub">Available liquidity</div>
    </div>
    <div class="metric-cell">
      <div class="m-key">Active Holdings</div>
      <div class="m-val">{{ current | length }}</div>
      <div class="m-sub">Max 8 per bylaws</div>
    </div>
    <div class="metric-cell">
      <div class="m-key">Fund Inception</div>
      <div class="m-val" style="font-size:1.35rem; letter-spacing:0;">17 Feb 2025</div>
      <div class="m-sub">Operational</div>
    </div>
  </div>

  <!-- ── PCT Strip ── -->
  <div class="pct-strip">
    {% for key, value in pct_changes.items() %}
    <div class="pct-cell">
      <span class="p-label">{{ key }}</span>
      <span class="p-val {% if value is not none and value >= 0 %}positive{% else %}negative{% endif %}">
        {% if value is not none %}
          {{ "%+.2f"|format(value) }}%
        {% else %}
          N/A
        {% endif %}
      </span>
    </div>
    {% endfor %}
  </div>

  <!-- ── Chart ── -->
  <div class="chart-section">
    <div class="chart-top-bar">
      <div class="chart-label">
        <h3>Portfolio Development</h3>
        <span>vs. ^OMX &amp; ^GSPC · indexed to inception</span>
      </div>
      <div class="button-container">
        <button onclick="setTimeRange('1m', this)">1M</button>
        <button onclick="setTimeRange('3m', this)">3M</button>
        <button onclick="setTimeRange('1y', this)">1Y</button>
        <button onclick="setTimeRange('ytd', this)">YTD</button>
        <button onclick="setTimeRange('all', this)" class="active">All</button>
      </div>
    </div>
    <div class="chart-container">
      <canvas id="valueChart"></canvas>
    </div>
    <div class="chart-legend">
      <div class="legend-item">
        <div class="legend-line" style="background: var(--accent);"></div>
        Portfolio
      </div>
      <div class="legend-item">
        <div class="legend-line" style="background: var(--text-faint); border-top: 1px dashed var(--text-faint); height:0; margin-top:1px;"></div>
        ^OMX
      </div>
      <div class="legend-item">
        <div class="legend-line" style="background: transparent; border-top: 1px dashed var(--text-faint); height:0; margin-top:1px; opacity:0.5;"></div>
        ^GSPC
      </div>
    </div>
  </div>

  <!-- ── Three-Column Info ── -->
  <div class="info-sections">

    <!-- Current Holdings -->
    <div class="info-column">
      <div class="col-header">
        <span class="col-number">01</span>
        <h3>Current Holdings</h3>
      </div>
      {% for item in current %}
      <div class="holding-item">
        <span class="h-name">{{ item }}</span>
        <span class="h-dot"></span>
      </div>
      {% endfor %}
    </div>

    <!-- Past Holdings -->
    <div class="info-column" id="prior-column">
      <div class="col-header">
        <span class="col-number">02</span>
        <h3>Prior Positions</h3>
      </div>
      {% for item in past[:7] %}
      <div class="past-item">{{ item }}</div>
      {% endfor %}

      <div class="past-overflow" id="past-overflow">
        {% for item in past[7:] %}
        <div class="past-item">{{ item }}</div>
        {% endfor %}
      </div>

      <button class="past-toggle" id="past-toggle" onclick="togglePast()">
        <span id="past-toggle-label">Show all</span>
        <span class="past-chevron" id="past-chevron">▾</span>
      </button>
    </div>

    <!-- Bylaws -->
    <div class="info-column bylaws-card">
      <div class="col-header">
        <span class="col-number">03</span>
        <h3>Articles of Association</h3>
      </div>

      <div class="bylaws-body">
        <div class="bylaws-doc-row">
          <div class="bylaws-doc-icon">
            <svg width="26" height="34" viewBox="0 0 26 34" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="0.5" y="0.5" width="25" height="33" rx="2.5" fill="var(--surface-2)" stroke="var(--border)"/>
              <path d="M16 0.5V8H25" stroke="var(--border)"/>
              <line x1="5" y1="13" x2="21" y2="13" stroke="var(--accent-dim)" stroke-width="1.1" stroke-linecap="round"/>
              <line x1="5" y1="17" x2="21" y2="17" stroke="var(--accent-dim)" stroke-width="1.1" stroke-linecap="round"/>
              <line x1="5" y1="21" x2="21" y2="21" stroke="var(--accent-dim)" stroke-width="1.1" stroke-linecap="round"/>
              <line x1="5" y1="25" x2="14" y2="25" stroke="var(--accent-dim)" stroke-width="1.1" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="bylaws-doc-info">
            <span class="bylaws-filename">Bylaws.pdf</span>
            <span class="bylaws-filetype">PDF · Governing Document</span>
          </div>
          <span class="bylaws-badge">PDF</span>
        </div>

        <p class="bylaws-description">
          The Articles of Association govern the investment mandate, decision-making process, and all formal provisions of FIGAB Capital Partners.
        </p>

        <a class="bylaws-open-btn" href="/reports/Bylaws.pdf" target="_blank" rel="noopener">
          <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 1V9M6 9L3 6M6 9L9 6" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M1 11H11" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
          </svg>
          Open Document
        </a>
      </div>
    </div>

  </div><!-- /info-sections -->

</main>

<footer>
  <div class="footer-inner">
    <span class="footer-brand">FIGAB Capital Partners</span>
    <span class="footer-meta">Private Investment Partnership &nbsp;·&nbsp; Est. 2025</span>
  </div>
</footer>


<script>
/* ── Chart setup ── */
const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

/* Read CSS variables for chart theming */
const style = getComputedStyle(document.documentElement);
const accentColor  = isDark ? '#4a7fe8' : '#2d6be4';
const textColor    = isDark ? '#7e8fa8' : '#4b5769';
const gridColor    = isDark ? 'rgba(36,48,72,0.8)' : 'rgba(221,226,234,0.8)';
const tooltipBg    = isDark ? '#1a2336' : '#ffffff';
const tooltipBorder= isDark ? '#243048' : '#dde2ea';
const tooltipTitle = isDark ? '#4a7fe8' : '#2d6be4';
const tooltipBody  = isDark ? '#7e8fa8' : '#4b5769';

const fullLabels = {{ line_labels | tojson }};
const fullData   = {{ line_data | tojson }};
const omxFull    = {{ omx_data | tojson }};
const gspcFull   = {{ gspc_data | tojson }};

const ctx = document.getElementById('valueChart').getContext('2d');

/* Gradient fill for portfolio line */
function makeGradient() {
  const h = ctx.canvas.clientHeight || 280;
  const grad = ctx.createLinearGradient(0, 0, 0, h);
  if (isDark) {
    grad.addColorStop(0, 'rgba(74,127,232,0.18)');
    grad.addColorStop(1, 'rgba(74,127,232,0.0)');
  } else {
    grad.addColorStop(0, 'rgba(45,107,228,0.12)');
    grad.addColorStop(1, 'rgba(45,107,228,0.0)');
  }
  return grad;
}

const isMobile = window.innerWidth < 600;

const valueChart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: fullLabels,
    datasets: [
      {
        label: 'Portfolio',
        data: fullData,
        borderColor: accentColor,
        backgroundColor: makeGradient(),
        fill: true,
        borderWidth: 1.8,
        pointRadius: 0,
        pointHoverRadius: 4,
        pointHoverBackgroundColor: accentColor,
        tension: 0.25
      },
      {
        label: '^OMX',
        data: omxFull,
        borderColor: '#C9A227',
        borderDash: [4, 5],
        fill: false,
        pointRadius: 0,
        borderWidth: 1.2,
        tension: 0.25
      },
      {
        label: '^GSPC',
        data: gspcFull,
        borderColor: '#B22222',
        borderDash: [2, 6],
        fill: false,
        pointRadius: 0,
        borderWidth: 1,
        tension: 0.25
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    interaction: { mode: 'index', intersect: false },
    plugins: {
      legend: { display: false },
      tooltip: {
        backgroundColor: tooltipBg,
        borderColor: tooltipBorder,
        borderWidth: 1,
        titleColor: tooltipTitle,
        bodyColor: tooltipBody,
        titleFont: { family: 'DM Mono, monospace', size: 11, weight: '400' },
        bodyFont: { family: 'DM Mono, monospace', size: 11 },
        padding: 12,
        callbacks: {
          label: ctx =>
            ` ${ctx.dataset.label}  ${Math.round(ctx.parsed.y).toLocaleString('sv-SE')} SEK`
        }
      }
    },
    scales: {
      x: {
        grid: { color: gridColor, borderColor: 'transparent' },
        afterBuildTicks(axis) {
          if (window.innerWidth <= 600) {
            const lastIdx = axis.chart.data.labels.length - 1;
            if (axis.ticks.length && axis.ticks[axis.ticks.length - 1].value !== lastIdx) {
              axis.ticks.push({ value: lastIdx });
            }
          }
        },
        ticks: {
          color: textColor,
          font: { family: 'DM Mono, monospace', size: 10 },
          maxRotation: window.innerWidth <= 600 ? 35 : 30,
          minRotation: window.innerWidth <= 600 ? 35 : 30,
          align: window.innerWidth <= 600 ? 'start' : 'center',
          autoSkip: true,
          maxTicksLimit: window.innerWidth <= 600 ? 10 : 10,
          includeBounds: true,
          callback: function(value, index, ticks) {
            const currentLabels = this.chart.data.labels;
            const label = currentLabels[value];
            if (!label) return '';
            if (window.innerWidth <= 600) {
              const d = new Date(label);
              return d.toLocaleDateString('en-GB', { month: 'short', year: '2-digit' });
            }
            return label;
          }
        },
      },
      y: {
        position: 'right',
        grid: { color: gridColor, borderColor: 'transparent' },
        ticks: {
          color: textColor,
          font: { family: 'DM Mono, monospace', size: 10 },
          callback: v => Math.round(v).toLocaleString('sv-SE')
        }
      }
    }
  }
});

/* ── Time range filter ── */
function togglePast() {
  const overflow = document.getElementById('past-overflow');
  const chevron  = document.getElementById('past-chevron');
  const label    = document.getElementById('past-toggle-label');
  const isOpen   = overflow.classList.toggle('open');
  chevron.classList.toggle('rotated', isOpen);
  label.textContent = isOpen ? 'Show less' : 'Show all';
}

function setTimeRange(range, btn) {
  /* Active button state */
  document.querySelectorAll('.button-container button').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');

  const now = new Date();
  let fromDate;
  if (range === '1m')       fromDate = new Date(now.getFullYear(), now.getMonth()-1, now.getDate());
  else if (range === '3m')  fromDate = new Date(now.getFullYear(), now.getMonth()-3, now.getDate());
  else if (range === '1y')  fromDate = new Date(now.getFullYear()-1, now.getMonth(), now.getDate());
  else if (range === 'ytd') fromDate = new Date(now.getFullYear(), 0, 1);
  else                      fromDate = new Date('1970-01-01');

  const fl=[], fp=[], fo=[], fg=[];
  fullLabels.forEach((l, i) => {
    if (new Date(l) >= fromDate) {
      fl.push(l); fp.push(fullData[i]); fo.push(omxFull[i]); fg.push(gspcFull[i]);
    }
  });

  if (fp.length === 0) return;

  /* Rebase comparisons to portfolio start value in this range */
  const base = fp[0], omxBase = fo[0], gspcBase = fg[0];
  const rebasedOMX  = fo.map(v => v * (base / omxBase));
  const rebasedGSPC = fg.map(v => v * (base / gspcBase));

  const combined = [...fp, ...rebasedOMX, ...rebasedGSPC];
  const minY = Math.min(...combined);
  const maxY = Math.max(...combined);
  const pad  = (maxY - minY) * 0.06;

  valueChart.options.scales.y.min = Math.floor((minY - pad) / 1000) * 1000;
  valueChart.options.scales.y.max = Math.ceil((maxY + pad) / 1000) * 1000;
  valueChart.data.labels = fl;
  valueChart.data.datasets[0].data = fp;
  valueChart.data.datasets[1].data = rebasedOMX;
  valueChart.data.datasets[2].data = rebasedGSPC;
  valueChart.update();
}
</script>
</body>
</html>
